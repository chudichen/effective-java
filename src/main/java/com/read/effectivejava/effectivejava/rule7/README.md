# 第7条：避免使用终结方法

终结方法（finalizer）通常是不可预测的，也是很危险的，一般情况下是不必要的。使用终结方法会导致行为不稳定，降低性能，以及可移植性问题。当然终结方法也有其可用之处，我们将在本条目最后再做介绍；但是根据经验，应该避免使用终结方法。

C++程序员被告知“不要把终结方法当作C++析构器的对应物”。在C++中，析构器是回收一个对象所占用资源的常规方法，是构造器所必须的对应物。在Java中，当一个对象变得不可到达的时候，垃圾回收器就会回收与该对象相关联的存储空间，并不需要程序员做专门的工作。C++的析构器也可以被用来回收其他的非内存资源。在Java中一般用try-finally块来完成类似的工作。

终结方法的缺点在于不能确保被及时地执行。从一个对象变得不可到达开始，到它的中介方法被执行，所花费的这段时间是任意长的。这就意味着，注重时间（time-critical）的任务不应该由终结方法来完成。例如，使用终结方法来关闭已经打开的文件，这是严重错误，因为打开文件的描述符是一种很有限的资源。由于JVM会延迟执行终结方法，所以大量的文件保留在打开状态，当一个程序不能打开文件的时候，它可能会运行失败。

及时地执行中介方法正是垃圾回收算法的一个主要功能，这种算法在不同的JVM实现种会大相径庭。如果程序依赖于终结方法被执行的时间点。如果程序依赖于终结方法被执行的时间点，那么这个程序在不同的JVM上运行表现可能会截然不同。一个程序在你的JVM平台上运行得非常好，而在你最重要的客户的JVM上平台却根本无法运行，这是完全有可能的。

延迟中介过程并不只是一个理论问题。在很少见的情况下，为类提供终结方法，可能会被随意